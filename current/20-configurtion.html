<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>Configuration Reference</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">friend-oauth2</span> <span class="project-version">0.3.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="10-usage.html"><div class="inner"><span>Usage</span></div></a></li><li class="depth-1  current"><a href="20-configurtion.html"><div class="inner"><span>Configuration Reference</span></div></a></li><li class="depth-1 "><a href="30-testing.html"><div class="inner"><span>Testing</span></div></a></li><li class="depth-1 "><a href="35-contributing.html"><div class="inner"><span>Contributing</span></div></a></li><li class="depth-1 "><a href="40-todo.html"><div class="inner"><span>TODO</span></div></a></li><li class="depth-1 "><a href="50-examples.html"><div class="inner"><span>Examples</span></div></a></li><li class="depth-1 "><a href="80-change-history.html"><div class="inner"><span>Change History</span></div></a></li><li class="depth-1 "><a href="89-related.html"><div class="inner"><span>Related Projects</span></div></a></li><li class="depth-1 "><a href="99-other-versions.html"><div class="inner"><span>Other Versions</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>friend-oauth2</span></div></div></li><li class="depth-2 branch"><a href="friend-oauth2.config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>examples</span></div></div></li><li class="depth-3 branch"><a href="friend-oauth2.examples.appdotnet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>appdotnet</span></div></a></li><li class="depth-3 branch"><a href="friend-oauth2.examples.facebook.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>facebook</span></div></a></li><li class="depth-3 branch"><a href="friend-oauth2.examples.github.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>github</span></div></a></li><li class="depth-3 branch"><a href="friend-oauth2.examples.google.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>google</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>legacy</span></div></div></li><li class="depth-4 branch"><a href="friend-oauth2.examples.legacy.appdotnet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>appdotnet</span></div></a></li><li class="depth-4 branch"><a href="friend-oauth2.examples.legacy.facebook.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>facebook</span></div></a></li><li class="depth-4 branch"><a href="friend-oauth2.examples.legacy.github.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>github</span></div></a></li><li class="depth-4"><a href="friend-oauth2.examples.legacy.google.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>google</span></div></a></li><li class="depth-2"><a href="friend-oauth2.service.html"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>service</span></div></a></li><li class="depth-3 branch"><a href="friend-oauth2.service.appdotnet.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>appdotnet</span></div></a></li><li class="depth-3 branch"><a href="friend-oauth2.service.facebook.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>facebook</span></div></a></li><li class="depth-3 branch"><a href="friend-oauth2.service.github.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>github</span></div></a></li><li class="depth-3"><a href="friend-oauth2.service.google.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>google</span></div></a></li><li class="depth-2 branch"><a href="friend-oauth2.util.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="friend-oauth2.workflow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>workflow</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#configuration-reference" name="configuration-reference"></a>Configuration Reference</h1>
<p>There are two ways in which one may configure use of <code>friend-oauth2</code>:</p>
<ul>
  <li>via two custom maps (<code>client-config</code> and <code>uri-config</code>), or</li>
  <li>via a single configuration record</li>
</ul>
<p>The latter is a new method and should not be considered for production use yet. For those applications that can take a chance on this new feature, we’d be greatly appreciative for usage, testing in the wild, and any bug reports!</p>
<h2><a href="#legacy-configuration" name="legacy-configuration"></a>Legacy Configuration</h2>
<p>The map passed to <code>oauth2/workflow</code> accepts various optional arguments, described below. See also the code in <code>examples/src</code> for working examples. Here’s some code from the Github example:</p>
<pre><code class="clj">(def callback-url (System/getenv "OAUTH2_CALLBACK_URL"))
(def parsed-url (url/url callback-url))

(def client-config
  {:client-id (System/getenv "OAUTH2_CLIENT_ID")
   :client-secret (System/getenv "OAUTH2_CLIENT_SECRET")
   :callback {:domain (format "%s://%s:%s"
                        (:protocol parsed-url)
                        (:host parsed-url)
                        (:port parsed-url))
              :path (:path parsed-url)}})

(def uri-config
  {:authentication-uri {:url "https://github.com/login/oauth/authorize"
                        :query {:client_id (:client-id client-config)
                                :response_type "code"
                                :redirect_uri callback-url
                                :scope "user"}}
   :access-token-uri {:url "https://github.com/login/oauth/access_token"
                      :query {:client_id (:client-id client-config)
                              :client_secret (:client-secret client-config)
                              :grant_type "authorization_code"
                              :redirect_uri callback-url}}})
</code></pre>
<ul>
  <li><code>client-config</code> holds the basic information which changes from app to app,  regardless of the provider: <code>:client-id</code>, <code>:client-secret</code>, and the  application’s callback url.</li>
  <li>The <code>authentication-uri</code> map holds the provider-specific configuration for  the initial redirect to the OAuth2 provider (the user-facing GET request).</li>
  <li>The <code>access-token-uri</code> map holds the provider-specific configuration for  the access_token request, after the code is returned from the previous  redirect (a server-to-server POST request).</li>
  <li><code>access-token-parsefn</code> is a provider-specific function which parses the  access_token response and returns just the access_token (see below).</li>
</ul>
<p>If your OAuth2 provider does not follow the RFC (<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-5.1">http://tools.ietf.org/html/draft-ietf-oauth-v2-31#section-5.1</a>, (“in the entity body of the HTTP response using the ”application/json“ media type as defined by [RFC4627]”) then you can pass in a custom function to parse the access_token response. Note that there is an alternate function (<code>get-access-token-from-params</code>) supplied to handle the common case where an access_token is provided as parameters in the callback request. Simply set the <code>:access-token-parsefn
get-access-token-from-params</code> See the Facebook and Github examples for reference.</p>
<h2><a href="#new-configuration" name="new-configuration"></a>New Configuration</h2>
<p>The new way of configuring <code>friend-oauth2</code> in an application makes use of the <code>friend-oauth2.config/Client</code> record. Here is some example usage for creating a new client configuration:</p>
<pre><code class="clj">(require '[friend-oauth2.config :as config]
(config/client
  :scope "user"
  :auth-uri "https://github.com/login/oauth/authorize"
  :token-uri "https://github.com/login/oauth/access_token")
</code></pre>
<p>Note that if the <code>:client-id</code>, <code>:client-secret</code>, and <code>:redirect-uri</code> arguments are not proivded, they are taken from the <code>OAUTH2_CLIENT_ID</code>, <code>OAUTH2_CLIENT_SECRET</code>, and <code>OAUTH2_CALLBACK_URL</code> environment variables.</p>
<p>The <code>Client</code> record defines the following authentication fields:</p>
<ul>
  <li><code>client-id</code></li>
  <li><code>redirect-uri</code></li>
  <li><code>response-type</code></li>
  <li><code>scope</code></li>
  <li><code>state</code></li>
  <li><code>access-type</code></li>
  <li><code>prompt</code></li>
  <li><code>login-hint</code></li>
  <li><code>include-granted-scopes</code></li>
  <li><code>adnview</code></li>
  <li><code>allow-signup</code></li>
</ul>
<p>combined with the following token access fields:</p>
<ul>
  <li><code>client-secret</code></li>
  <li><code>code</code></li>
  <li><code>grant-type</code></li>
</ul>
<p>and the following service configuration fields:</p>
<ul>
  <li><code>auth-uri</code></li>
  <li><code>token-uri</code></li>
</ul>
<p>We recommend using the constructor <code>friend-oauth2.config/client</code> which will populate a client configuration record with default values when not specified in the constructor.</p>
<p>If they are not provided, they will be looked up in the system environment, supplying those values instead.</p>
<p>and these are the defaults:</p>
<ul>
  <li><code>client-id</code>: <code>(System/getenv "OAUTH2_CLIENT_ID")</code></li>
  <li><code>client-secret</code>: <code>(System/getenv "OAUTH2_CLIENT_SECRET")</code></li>
  <li><code>redirect-uri</code>: <code>(System/getenv "OAUTH2_CALLBACK_URL")</code></li>
  <li><code>response-type</code>: <code>"code"</code></li>
  <li><code>grant-type</code>: <code>"authorization_code"</code></li>
</ul>
<p>and these are set to <code>nil</code> by default:</p>
<ul>
  <li><code>scope</code></li>
  <li><code>state</code></li>
  <li><code>access-type</code></li>
  <li><code>prompt</code></li>
  <li><code>login-hint</code></li>
  <li><code>include-granted-scopes</code></li>
  <li><code>adnview</code></li>
  <li><code>allow-signup</code></li>
  <li><code>auth-uri</code></li>
  <li><code>token-uri</code></li>
</ul>
<p>Backwards compatibility with the legacy <code>friend-oauth2</code> configuration is facilitated by several configuration utility functions that perform appropriate tranformations from the record-based approach.</p>
<h2><a href="#service-configuration" name="service-configuration"></a>Service Configuration</h2>
<p>If, instead of creating a service configuration from scratch, you chose to use one of the <a href="https://github.com/clojusc/friend-oauth2/tree/master/src/friend_oauth2/service">predefined <code>friend-oauth2</code> services</a>, the steps required are fewer and a little bit different.</p>
<p>First of all, you won’t call <code>friend-oauth2.workflow/workflow</code>; you’ll call <code>friend-oauth2.service.&lt;name&gt;/workflow</code> (e.g., <code>friend-oauth2.service.github/workflow</code>).</p>
<p>Secondly, you won’t pass a map with <code>:config</code> set to an instance of <code>friend-oauth2.config/Client</code>; you’ll pass a map witb <code>:config</code> set to a simple map data structure with just the bits you need (e.g., <code>{:scope "user"}</code>).</p>
<p>This is the approach used in the non-legacy examples.</p>
<h2><a href="#configuration-sources" name="configuration-sources"></a>Configuration Sources</h2>
<p>The fields for the record above are the combination of the fields taken from the OAuth2 services supported by <code>friend-oauth2</code>. Each is covered below in its own sub-section.</p>
<h3><a href="#app-net" name="app-net"></a>App.net</h3>
<p><a href="https://developers.app.net/reference/authentication/flows/web/#server-side-flow">App.net’s OAuth2 service</a> supports the following query string parameters for the authorization phase:</p>
<ul>
  <li><code>client_id</code></li>
  <li><code>response_type</code> (value <code>code</code>)</li>
  <li><code>redirect_uri</code></li>
  <li><code>scope</code></li>
  <li><code>state</code></li>
  <li><code>adnview</code></li>
</ul>
<p>And it supports the following for access code exchange:</p>
<ul>
  <li><code>code</code></li>
  <li><code>client_id</code></li>
  <li><code>client_secret</code></li>
  <li><code>redirect_uri</code></li>
  <li><code>grant_type</code> (value <code>authorization_code</code>)</li>
</ul>
<h3><a href="#facebook" name="facebook"></a>Facebook</h3>
<p><a href="https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow">Facebook’s OAuth2 service</a> supports the following query string parameters for the authorization phase:</p>
<ul>
  <li><code>client_id</code></li>
  <li><code>response_type</code> (values <code>code</code>, <code>token</code>, <code>code%20token</code>, or  <code>granted_scopes</code>)</li>
  <li><code>redirect_uri</code></li>
  <li><code>scope</code></li>
  <li><code>state</code></li>
</ul>
<p>And it supports the following for access code exchange:</p>
<ul>
  <li><code>code</code></li>
  <li><code>client_id</code></li>
  <li><code>client_secret</code></li>
  <li><code>redirect_uri</code></li>
</ul>
<h3><a href="#github" name="github"></a>Github</h3>
<p><a href="https://developer.github.com/v3/oauth/">Github’s OAuth2 service</a> supports the following query string parameters for the authorization phase:</p>
<ul>
  <li><code>client_id</code></li>
  <li><code>redirect_uri</code></li>
  <li><code>scope</code></li>
  <li><code>state</code></li>
  <li><code>allow_signup</code> (values <code>true</code> or <code>false</code>)</li>
</ul>
<p>And it supports the following for access code exchange:</p>
<ul>
  <li><code>code</code></li>
  <li><code>client_id</code></li>
  <li><code>client_secret</code></li>
  <li><code>redirect_uri</code></li>
  <li><code>state</code></li>
</ul>
<h3><a href="#google" name="google"></a>Google</h3>
<p><a href="https://developers.google.com/identity/protocols/OAuth2WebServer">Google’s OAuth2 service</a> supports the following query string parameters for the authorization phase:</p>
<ul>
  <li><code>response_type</code> (value <code>code</code>)</li>
  <li><code>client_id</code></li>
  <li><code>redirect_uri</code></li>
  <li><code>scope</code></li>
  <li><code>state</code></li>
  <li><code>access_type</code> (values <code>online</code> and <code>offline</code>)</li>
  <li><code>prompt</code> (values <code>none</code>, <code>consent</code>, or <code>select_account</code>)</li>
  <li><code>login_hint</code></li>
  <li><code>include_granted_scopes</code> (values <code>true</code> or <code>false</code>)</li>
</ul>
<p>And it supports the following for access code exchange:</p>
<ul>
  <li><code>code</code></li>
  <li><code>client_id</code></li>
  <li><code>client_secret</code></li>
  <li><code>redirect_uri</code></li>
  <li><code>grant_type</code> (value <code>authorization_code</code>)</li>
</ul></div></div></div></body></html>